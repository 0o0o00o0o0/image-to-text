(window.webpackJsonp=window.webpackJsonp||[]).push([["app"],{"./src/index.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/react/index.js"),a=n.n(r),o=n("./node_modules/react-dom/index.js"),i=n.n(o);function s(){return a.a.createElement("div",{className:"divide"})}var l=n("./node_modules/classnames/index.js"),c=n.n(l),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function f(e){var t=e.children,n=e.className,r=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["children","className"]);return n=c()(n,"btn"),a.a.createElement("button",u({},r,{type:"button",className:n}),t)}var p={PNG:/image\/png/,JPG:/image\/jpe?g/,GIF:/image\/gif/};function m(e){for(var t in p){if(p.hasOwnProperty(t))if(p[t].test(e))return t}}var h=12,d=6,g="normal normal 400 normal 12px / 12px monospace, monospace";function v(e,t,n){"GIF"===m(n.type)?function(e,t){console.log(t),console.log("To Be Continue...")}(0,t):function(e,t){var n=document.createElement("canvas"),r=getComputedStyle(e);n.width=parseInt(r.width),n.height=parseInt(r.height);var a=n.getContext("2d");a.font=g;for(var o=0;o<t.length;o++)for(var i=0;i<t[o].length;i++)a.fillText(t[o][i],i*d,o*h);n.toDataURL("image/jpg")}(e,t[0])}n("./src/style/modal.css");var y=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var b=200,w=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.savePic=function(){v(n.outputRef.current,n.props.frames,n.props.file)},n.updatePlayDelay=function(){var e=n.playDelayInput.current.value,t=e.length?parseInt(e,10):b;isNaN(t)&&(t=b),n.setState({playDelay:t})},n.close=function(e){e.preventDefault(),n.stop(),n.setState({open:!1})},n.open=function(){n.play(),n.setState({open:!0})},n.state={open:!1,playingIndex:0,playDelay:b},n.playTimer=null,n.playDelayInput=a.a.createRef(),n.outputRef=a.a.createRef(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.a.PureComponent),y(t,[{key:"componentWillUnmount",value:function(){this.stop()}},{key:"play",value:function(){var e=this;if(!(this.props.frames.length<=1)){!function t(){e.playTimer=setTimeout(function(){var n=e.state.playingIndex+1;n===e.props.frames.length&&(n=0),e.setState({playingIndex:n}),t()},e.state.playDelay)}()}}},{key:"stop",value:function(){this.playTimer&&clearTimeout(this.playTimer)}},{key:"render",value:function(){var e=c()({modal:!0,open:this.state.open});return a.a.createElement("div",{className:e},a.a.createElement("div",{className:"modal-overlay"}),a.a.createElement("div",{className:"modal-box"},a.a.createElement("div",{className:"modal-header"},a.a.createElement("a",{href:"#",className:"modal-close",onClick:this.close},"X"),a.a.createElement("h3",{className:"modal-title"},"图片转化结果")),a.a.createElement(s,null),a.a.createElement("div",{className:"output-options"},this.props.file&&"image/gif"===this.props.file.type?a.a.createElement("span",null,a.a.createElement("input",{defaultValue:b,className:"play-delay-input",ref:this.playDelayInput,placeholder:"播放帧间隔(ms)"}),a.a.createElement(f,{className:"update-btn",onClick:this.updatePlayDelay},"更新间隔时间(ms)")):null,a.a.createElement(f,{className:"save-btn",onClick:this.savePic},"保存为图片")),a.a.createElement(s,null),a.a.createElement("div",{className:"output-text-wrapper"},a.a.createElement("div",{id:"output-text-block",className:"output-text-block",ref:this.outputRef},this.props.frames.length?this.props.frames[this.state.playingIndex].map(function(e,t){return a.a.createElement("pre",{key:t},e)}):null))))}}]),t}(),E=n("./node_modules/prop-types/index.js"),O=n.n(E),j=(n("./src/style/transformSetting.css"),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}());var I=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.a.PureComponent),j(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"transform-setting"},this.props.label?a.a.createElement("label",{htmlFor:this.props.labelFor},this.props.label):null,this.props.children)}}]),t}();I.propTypes={label:O.a.string,labelFor:O.a.string},I.defaultProps={label:"",labelFor:""};var P=I,_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function N(e){var t=e.children,n=e.className,r=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["children","className"]);return n=c()(n,"row"),a.a.createElement("div",_({},r,{className:n}),t)}n("./src/style/imagePreviewUpload.css");var x=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var k=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.size=function(){return{width:n.state.width,height:n.state.height}},n.dragEnter=function(e){e.preventDefault(),n.setState({isDragging:!0})},n.dragOver=function(e){e.preventDefault()},n.dragLeave=function(e){e.preventDefault(),n.setState({isDragging:!1})},n.drop=function(e){e.preventDefault(),n.setState({isDragging:!1});var t=e.dataTransfer.files[0];n.previewImage(t)},n.openFileInput=function(){n.fileUpload.current.click()},n.setFile=function(e){var t=e.target.files[0];t&&n.previewImage(t)},n.state={isDragging:!1,width:400,height:250},n.fileUpload=a.a.createRef(),n.currentImageRef=a.a.createRef(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.a.Component),x(t,[{key:"getCurrentImage",value:function(){return this.currentImageRef.current}},{key:"previewImage",value:function(e){var t=this;if(function(e){for(var t in p)if(p.hasOwnProperty(t)&&p[t].test(e))return!0;return!1}(e.type)){var n=new FileReader;n.readAsDataURL(e),n.addEventListener("load",function(){var r=new Image;r.addEventListener("load",function(){t.scaleImageContainer(r),t.props.setImageAndFile(r,e)}),r.src=n.result})}else alert("不支持该格式的文件")}},{key:"scaleImageContainer",value:function(e){e||(e=this.props.image);var t=this.props.previewWidth;t||(t=window.innerWidth,e.width<t&&(t=e.width));var n=e.width/t,r=e.height/n;this.setState({width:t,height:r})}},{key:"render",value:function(){var e=c()("upload-image-block",{active:this.state.isDragging},this.props.className);return a.a.createElement("div",{onDragEnter:this.dragEnter,onDragOver:this.dragOver,onDragLeave:this.dragLeave,onDrop:this.drop,onClick:this.openFileInput,className:e,style:{width:this.state.width,height:this.state.height}},a.a.createElement("input",{type:"file",style:{display:"none"},accept:"image/*",ref:this.fileUpload,onChange:this.setFile}),a.a.createElement("span",{className:"upload-label"},"上传图片"),this.props.image?a.a.createElement("img",{ref:this.currentImageRef,src:this.props.image.src,className:"preview-image"}):null)}}]),t}();var C=255,D="@#&$%O!~;*^+-. ";function R(e){for(var t,n,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D;return function(t){var n=C/e.length;return e[t/n>>0][0]}}(),o=e.data,i=e.width,s=e.height,l=[],c=0;c<s;c+=12){for(var u="",f=0;f<i;f+=6){var p=4*(f+i*c);u+=a((t=o[p],n=o[p+1],r=o[p+2],.299*t+.578*n+.114*r))}l.push(u)}return l}var T=n("./node_modules/omggif/omggif.js"),S=n("./node_modules/parse-data-uri/index.js"),F=n.n(S);function W(e,t){switch(m(t.type).toUpperCase()){case"GIF":return function(e){for(var t=F()(e.src).data,n=new T.GifReader(t),r=n.numFrames(),a=n.width,o=n.height,i=[],s=0;s<r;s++){var l=new Uint8Array(a*o*4);n.decodeAndBlitFrameRGBA(s,l),i.push({width:a,height:o,data:l})}return console.log(i),i}(e);case"PNG":case"JPG":return function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=e.width/e.naturalWidth;return n.scale(r,r),r>1?(t.width=e.width,t.height=e.height):(t.width=e.naturalWidth,t.height=e.naturalHeight),n.drawImage(e,0,0,e.width,e.height),[n.getImageData(0,0,e.width,e.height)]}(e);default:return null}}var U=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var G=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setImageAndFile=function(t,n){e.setState({rawImage:t,file:n})},e.setTransformType=function(t){e.setState({transformType:t.target.value})},e.setTransformWidth=function(t){var n=t.target.value,r=n.length?parseInt(n,10):0;isNaN(r)||e.setState({transformWidth:r.toString()})},e.rescale=function(){e.imagePreview.current.scaleImageContainer()},e.transform=function(){var t=W(e.imagePreview.current.getCurrentImage(),e.state.file).map(function(e){return R(e)});e.setState({transformResult:t},function(){e.framesModal.current.open()})},e.state={transformWidth:"",transformResult:[],rawImage:null,file:null},e.imagePreview=a.a.createRef(),e.framesModal=a.a.createRef(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.a.Component),U(t,[{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("header",null,a.a.createElement("h1",{className:"text-center"},"图片转字符画工具")),a.a.createElement(s,null),a.a.createElement(N,{className:"transform-settings-wrapper"},a.a.createElement(P,{label:"目标图片宽度:",labelFor:"transform-size"},a.a.createElement("input",{type:"number",id:"transform-size",className:"transform-size-input",name:"transform-size",value:this.state.transformWidth,onChange:this.setTransformWidth})),a.a.createElement(f,{onClick:this.rescale},"重新缩放"),a.a.createElement(f,{onClick:this.transform},"开始转化")),a.a.createElement(s,null),a.a.createElement(N,null,a.a.createElement(k,{file:this.state.file,image:this.state.rawImage,setImageAndFile:this.setImageAndFile,previewWidth:parseInt(this.state.transformWidth),ref:this.imagePreview})),a.a.createElement(w,{ref:this.framesModal,frames:this.state.transformResult,file:this.state.file}))}}]),t}();n("./src/style/normalize.css"),n("./src/style/index.css");i.a.render(a.a.createElement(G,null),document.getElementById("app"))},"./src/style/imagePreviewUpload.css":function(e,t,n){},"./src/style/index.css":function(e,t,n){},"./src/style/modal.css":function(e,t,n){},"./src/style/normalize.css":function(e,t,n){},"./src/style/transformSetting.css":function(e,t,n){}},[["./src/index.js","manifest","vendors"]]]);
//# sourceMappingURL=app.f20bfa877d4800bebc08.js.map