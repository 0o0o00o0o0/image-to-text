(window.webpackJsonp=window.webpackJsonp||[]).push([["app"],{"./src/index.js":function(e,t,r){"use strict";r.r(t);var n=r("./node_modules/react/index.js"),a=r.n(n),o=r("./node_modules/react-dom/index.js"),i=r.n(o),s=r("./node_modules/babel-runtime/regenerator/index.js"),l=r.n(s);function c(){return a.a.createElement("div",{className:"divide"})}var u=r("./node_modules/classnames/index.js"),f=r.n(u),p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function m(e){var t=e.children,r=e.className,n=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["children","className"]);return r=f()(r,"btn"),a.a.createElement("button",p({},n,{type:"button",className:r}),t)}var h=r("./node_modules/prop-types/index.js"),y=r.n(h),v=(r("./src/style/modal.css"),function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}());var d=200,g=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.updatePlayDelay=function(){var t=e.playDelayInput.current.value,r=t.length?parseInt(t,10):d;isNaN(r)&&(r=d),e.setState({playDelay:r})},e.close=function(t){t.preventDefault(),e.stop(),e.setState({open:!1})},e.open=function(){e.play(),e.setState({open:!0})},e.state={open:!1,playingIndex:0,playDelay:d},e.playTimer=null,e.playDelayInput=a.a.createRef(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.a.PureComponent),v(t,[{key:"componentWillUnmount",value:function(){this.stop()}},{key:"play",value:function(){var e=this;if(!(this.props.result.length<=1)){!function t(){e.playTimer=setTimeout(function(){var r=e.state.playingIndex+1;r===e.props.result.length&&(r=0),e.setState({playingIndex:r}),t()},e.state.playDelay)}()}}},{key:"stop",value:function(){this.playTimer&&clearTimeout(this.playTimer)}},{key:"render",value:function(){var e=f()({modal:!0,open:this.state.open});return a.a.createElement("div",{className:e},a.a.createElement("div",{className:"modal-overlay"}),a.a.createElement("div",{className:"modal-box"},a.a.createElement("div",{className:"modal-header"},a.a.createElement("a",{href:"#",className:"modal-close",onClick:this.close},"X"),a.a.createElement("h3",{className:"modal-title"},"图片转化结果"),a.a.createElement("div",{className:"output-options"},a.a.createElement("input",{defaultValue:d,className:"play-delay-input",ref:this.playDelayInput,placeholder:"播放帧间隔(ms)"}),a.a.createElement(m,{className:"update-btn",onClick:this.updatePlayDelay},"更新间隔时间(ms)"),a.a.createElement(m,{className:"save-btn",disabled:!0},"保存为图片"))),a.a.createElement(c,null),a.a.createElement("div",{className:"output-text-wrapper"},a.a.createElement("div",{className:"output-text-block"},this.props.result.length?this.props.result[this.state.playingIndex].map(function(e,t){return a.a.createElement("pre",{key:t},e)}):null))))}}]),t}();g.propTypes={result:y.a.arrayOf(y.a.arrayOf(y.a.string))};var b=g,w=(r("./src/style/transformSetting.css"),function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}());var E=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.a.PureComponent),w(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"transform-setting"},this.props.label?a.a.createElement("label",{htmlFor:this.props.labelFor},this.props.label):null,this.props.children)}}]),t}();E.propTypes={label:y.a.string,labelFor:y.a.string},E.defaultProps={label:"",labelFor:""};var O=E,P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function j(e){var t=e.children,r=e.className,n=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["children","className"]);return r=f()(r,"row"),a.a.createElement("div",P({},n,{className:r}),t)}r("./src/style/imagePreviewUpload.css");function x(e){if("function"==typeof e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];e.apply(void 0,r)}}var _=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var T=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.dragEnter=function(t){t.preventDefault(),x(e.props.onDragEnter,t)},e.dragOver=function(t){t.preventDefault(),x(e.props.onDragOver,t)},e.dragLeave=function(t){t.preventDefault(),x(e.props.onDragLeave,t)},e.drop=function(t){t.preventDefault(),x(e.props.onDrop,t);var r=t.dataTransfer.files[0];e.previewImage(r)},e.openFileInput=function(){e.fileUpload.current.click()},e.setFile=function(t){var r=t.target.files[0];r&&e.previewImage(r)},e.state={file:null,image:null,width:400,height:250},e.fileUpload=a.a.createRef(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.a.Component),_(t,[{key:"getFile",value:function(){return this.state.file}},{key:"getImage",value:function(){return this.state.image}},{key:"previewImage",value:function(e){var t=this;if(e.type.match(/image\/.*/)){var r=new FileReader;r.readAsDataURL(e),r.addEventListener("load",function(){var n=new Image;n.addEventListener("load",function(){t.scaleImageContainer(n),t.setState({file:e,image:n})}),n.src=r.result})}else alert("请选择图片文件")}},{key:"scaleImageContainer",value:function(e){e||(e=this.state.image);var t=this.props.previewWidth;t||(t=window.innerWidth,e.width<t&&(t=e.width));var r=e.width/t,n=e.height/r;this.setState({width:t,height:n})}},{key:"render",value:function(){var e=f()("upload-image-block",this.props.className);return a.a.createElement("div",{onDragEnter:this.dragEnter,onDragOver:this.dragOver,onDragLeave:this.dragLeave,onDrop:this.drop,onClick:this.openFileInput,className:e,style:{width:this.state.width,height:this.state.height}},a.a.createElement("input",{type:"file",style:{display:"none"},accept:"image/*",ref:this.fileUpload,onChange:this.setFile}),a.a.createElement("span",{className:"upload-label"},"上传图片"),this.state.image?a.a.createElement("img",{src:this.state.image.src,className:"preview-image"}):null)}}]),t}();T.propTypes={onDragEnter:y.a.func,onDragOver:y.a.func,onDragLeave:y.a.func,onDrop:y.a.func,previewWidth:y.a.number};var N=T,k=r("./src/tools/imageToText.js"),I=r.n(k),S=r("./node_modules/get-pixels/dom-pixels.js"),D=r.n(S),R=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var C={PNG:/image\/png/,JPG:/image\/jpe?g/,GIF:/image\/gif/};function F(e){for(var t in C){if(C.hasOwnProperty(t))if(C[t].test(e))return t}}function W(e){return new Promise(function(t,r){D()(e.src,function(e,n){if(e)r(e);else{for(var a=R(n.shape,3),o=a[0],i=a[1],s=a[2],l=[],c=n.data.length/o,u=0;u<o;u++){var f=u*c;l.push({width:i,height:s,data:n.data.slice(f,f+c)})}t(l)}})})}function B(e){return new Promise(function(t,r){D()(e.src,function(e,n){if(e)r(e);else{var a=R(n.shape,2),o=a[0],i=a[1];t([{width:o,height:i,data:n.data}])}})})}function L(e){return new Promise(function(t,r){D()(e.src,function(e,n){if(e)r(e);else{var a=R(n.shape,2),o=a[0],i=a[1];t([{width:o,height:i,data:n.data}])}})})}var U=function(){var e,t=(e=l.a.mark(function e(t,r){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=F(r.type),e.t0=n.toUpperCase(),e.next="PNG"===e.t0?4:"JPG"===e.t0?7:"GIF"===e.t0?10:13;break;case 4:return e.next=6,L(t);case 6:return e.abrupt("return",e.sent);case 7:return e.next=9,B(t);case 9:return e.abrupt("return",e.sent);case 10:return e.next=12,W(t);case 12:return e.abrupt("return",e.sent);case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,o){try{var i=t[a](o),s=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})});return function(e,r){return t.apply(this,arguments)}}(),G=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var z={BORWSER:"browser",SERVER:"server"},A=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setTransformType=function(t){e.setState({transformType:t.target.value})},e.setTransformWidth=function(t){var r=t.target.value,n=r.length?parseInt(r,10):0;isNaN(n)||e.setState({transformWidth:n.toString()})},e.rescale=function(){e.imagePreview.current.scaleImageContainer()},e.transform=function(){switch(e.state.transformType){case z.BORWSER:e.transformByCanvas();break;case z.SERVER:e.transformByServer()}},e.state={transformType:"browser",transformWidth:"",transformResult:[]},e.imagePreview=a.a.createRef(),e.resultModal=a.a.createRef(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.a.Component),G(t,[{key:"transformByCanvas",value:function(){var e,t=(e=l.a.mark(function e(){var t,r,n,a,o=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.imagePreview.current.getImage(),r=this.imagePreview.current.getFile(),e.next=4,U(t,r);case 4:n=e.sent,a=n.map(function(e){return I.a.transformImageFrame(e)}),this.setState({transformResult:a},function(){o.resultModal.current.open()});case 7:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,o){try{var i=t[a](o),s=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})});return function(){return t.apply(this,arguments)}}()},{key:"transformByServer",value:function(){console.log("transformByServer")}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("header",null,a.a.createElement("h1",{className:"text-center"},"图片转字符画工具")),a.a.createElement(c,null),a.a.createElement(j,{className:"transform-settings-wrapper"},a.a.createElement(O,{label:"转化方式:",labelFor:"transform-type"},a.a.createElement("select",{name:"transform-type",id:"transform-type",onChange:this.setTransformType,value:this.state.transformType},a.a.createElement("option",{value:z.BORWSER},"浏览器"),a.a.createElement("option",{value:z.SERVER},"服务器"))),a.a.createElement(O,{label:"目标图片宽度:",labelFor:"transform-size"},a.a.createElement("input",{type:"number",id:"transform-size",className:"transform-size-input",name:"transform-size",value:this.state.transformWidth,onChange:this.setTransformWidth})),a.a.createElement(m,{onClick:this.rescale},"重新缩放"),a.a.createElement(m,{onClick:this.transform},"开始转化")),a.a.createElement(c,null),a.a.createElement(j,null,a.a.createElement(N,{previewWidth:parseInt(this.state.transformWidth),ref:this.imagePreview})),a.a.createElement(b,{ref:this.resultModal,result:this.state.transformResult}))}}]),t}();r("./src/style/normalize.css"),r("./src/style/index.css");i.a.render(a.a.createElement(A,null),document.getElementById("app"))},"./src/style/imagePreviewUpload.css":function(e,t,r){},"./src/style/index.css":function(e,t,r){},"./src/style/modal.css":function(e,t,r){},"./src/style/normalize.css":function(e,t,r){},"./src/style/transformSetting.css":function(e,t,r){},"./src/tools/imageToText.js":function(e,t){var r=255,n="@#&$%O!~;*^+-. ";function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n;return function(t){var n=r/e.length;return e[t/n>>0][0]}}e.exports={createGrayToTextFunc:a,transformImageFrame:function(e){for(var t,r,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a(),i=e.data,s=e.width,l=e.height,c=[],u=0;u<l;u+=12){for(var f="",p=0;p<s;p+=6){var m=4*(p+s*u);f+=o((t=i[m],r=i[m+1],n=i[m+2],.299*t+.578*r+.114*n))}c.push(f)}return c}}},2:function(e,t){},3:function(e,t){}},[["./src/index.js","manifest","vendors"]]]);
//# sourceMappingURL=app.21ff83684b02d782e7ae.js.map